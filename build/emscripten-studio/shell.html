<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Suika2 Studio Web</title>
  <meta name="viewport" content="width=device-width, user-scalable=no, maximum-scale=1, initial-scale=1">
  <style>
    html, body {
        padding 0;
        margin: 0;
        width: 100%;
        height: 100%;
    }
    div.holder {
        border: 0px;
        margin: auto;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    canvas.emscripten {
        background-color: black;
        vertical-align: middle;
        -webkit-tap-highlight-color: rgba(255, 255, 255, 0);
    }
		div.grid-holder {
				display: grid;
				width: 100%;
				height: 100%;
				grid-template-rows: calc(100vh - 440px) 40px 400px;
				grid-template-columns: 100%;
		}
		div.grid-top {
				grid-row: 1;
				grid-column: 1;
				width: 100%;
				height: 100%;
		}
		div.grid-middle {
				grid-row: 2;
				grid-column: 1;
				width: 100%;
				height: 100%;
		}
		div.grid-bottom {
				grid-row: 3;
				grid-column: 1;
				width: 100%;
				height: 100%;
		}
  </style>
</head>
<body style="padding: 0; margin: 0;">

  <!-- The DOM Elements -->
	<div class="grid-holder">

		<!-- The top panel -->
		<div class="grid-top">
			<div id="holder" class="holder">
				<!-- The element for video playback --> 
				<video id="video" style="width: 100%; display: none;"></video>  

				<!-- The element for game screen -->
				<canvas id="canvas" class="emscripten" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>
			</div>
		</div>

		<!-- The middle panel -->
		<div class="grid-middle">
			<button id="btnProject">プロジェクトを開く</button>
			<button id="btnContinue">続ける</button>
			<button id="btnNext">次へ</button>
			<button id="btnStop">停止</button>
			<span id="fileName">ファイル名</span>
			<button id="btnOpen">...</button>
			<span id="runningStatus"></span>
			<span id="lineNumber"></span>
			<span id="scriptLineText"></span>
		</div>

		<!-- The bottom side panel -->
		<div class="grid-bottom">
			<span id="scriptText"></span>
		</div>
	</div>
	<!-- End of the DOM Elements -->

  <!-- Code for Emscripten foundation-->
  <script type='text/javascript'>
    var Module = {
      preRun: [],
      postRun: [],
      print: (function(text) {
					if(typeof text !== 'undefined')
            window.alert(text);
      })(),
      printErr: function(text) {
        window.alert(text);
      },
      canvas: (function() {
        var canvas = document.getElementById('canvas');
        canvas.addEventListener("webglcontextlost", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);
        return canvas;
      })(),
      totalDependencies: 0,
      monitorRunDependencies: function(left) {
        this.totalDependencies = Math.max(this.totalDependencies, left);
      }
    };
    window.onerror = function() {
      window.alert('Exception thrown, see JavaScript console');
    };
  </script>

  <!-- Code for Suika2 Main Engine -->
  <script type="text/javascript">
    function resizeWindow(event) {
      canvas = document.getElementById('canvas');
      aspect = canvas.width / canvas.height;
      holder = document.getElementById('holder');
      w = holder.offsetWidth ;
      h = holder.offsetWidth / aspect;
      if(h > window.innerHeight) {
           h = holder.offsetHeight;
           w = holder.offsetHeight * aspect;
      }
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      canvas.focus();
    }
    function visibilityChange() {
      if(document.visibilityState === 'visible') {
        Module.ccall('setVisible', null, null, null);
        document.getElementById('canvas').focus();
      } else if(document.visibilityState === 'hidden') {
        Module.ccall('setHidden', null, null, null);
      }
    }
    function preventDefault(e) {
				e.preventDefault();
    }
    window.ontouchmove = preventDefault;
    window.onwheel = preventDefault;
    document.ontouchmove = preventDefault;
    document.onwheel = preventDefault;
    document.body.addEventListener('touchmove', preventDefault, { passive: false });
    document.body.addEventListener('wheel', preventDefault, { passive: false });
    window.addEventListener('resize', resizeWindow);
    document.addEventListener('visibilitychange', visibilityChange);
  </script>

  <!-- Code for Suika2 Studio -->
  <script type="text/javascript">
		var dirHandle = null;
		document.getElementById('btnProject').onclick = async () => {
				dirHandle = await window.showDirectoryPicker({mode: "readwrite"});
				Module.ccall('onLoadProject', null, null, null);
		};
		document.getElementById('btnContinue').onclick = () => {
				Module.ccall('onClickContinue', null, null, null);
		};
		document.getElementById('btnNext').onclick = () => {
				Module.ccall('onClickNext', null, null, null);
		};
		document.getElementById('btnStop').onclick = () => {
				Module.ccall('onClickStop', null, null, null);
		};
	</script>

	<!-- Placeholder for Emscripten generated code-->
  {{{ SCRIPT }}}

</body>
</html>
